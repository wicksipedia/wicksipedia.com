---
import type { HTMLAttributes } from "astro/types";
import Socials from "./Socials.astro";
import IconRss from "@/assets/icons/IconRss.svg";
import LinkButton from "./LinkButton.astro";
import { SITE } from "@/config";
import { execSync } from "child_process";

const currentYear = new Date().getFullYear();

let commitSha = "";
let commitShort = "";
try {
  commitSha = execSync("git rev-parse HEAD").toString().trim();
  commitShort = execSync("git rev-parse --short HEAD").toString().trim();
} catch {
  // If git command fails, commit info will be empty
}

type Props = {
  noMarginTop?: boolean;
} & HTMLAttributes<"footer">;

const { noMarginTop = false, class: className, ...attrs } = Astro.props;
---

<footer
  class:list={[{ "mt-auto": !noMarginTop }, className]}
  {...attrs}
>
  <div class="bg-muted/40 border-t border-border/60">
    <div class="app-layout">
      <div class="flex flex-col items-center gap-4 py-8 sm:flex-row sm:justify-between sm:py-6">
        <div class="flex flex-col items-center gap-1.5 sm:items-start">
          <div class="flex items-baseline gap-1.5">
            <span class="text-sm font-bold tracking-tight text-foreground">
              {SITE.title}
            </span>
            <span class="inline-block size-1.5 rounded-full bg-accent opacity-80"></span>
          </div>
          <div class="flex items-center gap-2 text-xs text-foreground/50">
            <span>&copy; {currentYear}</span>
            <span aria-hidden="true" class="text-border">|</span>
            <span>All rights reserved</span>
            {commitShort && (
              <>
                <span aria-hidden="true" class="text-border">|</span>
                <a
                  href={`${SITE.repo}/commit/${commitSha}`}
                  target="_blank"
                  rel="noopener noreferrer"
                  class="font-mono text-accent/70 transition-opacity hover:text-accent hover:underline"
                  title={`Commit: ${commitSha}`}
                >
                  {commitShort}
                </a>
              </>
            )}
          </div>
        </div>

        <div class="flex flex-wrap items-center gap-1">
          <LinkButton
            href="/rss.xml"
            class="p-2 hover:rotate-6 sm:p-1"
            title="RSS Feed"
            target="_blank"
          >
            <IconRss class="inline-block size-6 scale-125 fill-transparent stroke-current stroke-2 opacity-90 sm:scale-110" />
            <span class="sr-only">RSS Feed</span>
          </LinkButton>
          <Socials />
        </div>
      </div>
    </div>
  </div>
</footer>
